<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Metainspector by jaimeiniesta</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Metainspector</h1>
        <h2>Ruby gem for web scraping purposes.</h2>
        <a href="https://github.com/jaimeiniesta/metainspector" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="metainspector--" class="anchor" href="#metainspector--"><span class="octicon octicon-link"></span></a>MetaInspector <a href="http://travis-ci.org/jaimeiniesta/metainspector"><img src="https://secure.travis-ci.org/jaimeiniesta/metainspector.png" alt="Build Status"></a> <a href="https://gemnasium.com/jaimeiniesta/metainspector"><img src="https://gemnasium.com/jaimeiniesta/metainspector.png" alt="Dependency Status"></a>
</h1>

<p>MetaInspector is a gem for web scraping purposes.</p>

<p>You give it an URL, and it lets you easily get its title, links, images, charset, description, keywords, meta tags...</p>

<h2>
<a name="see-it-in-action" class="anchor" href="#see-it-in-action"><span class="octicon octicon-link"></span></a>See it in action!</h2>

<p>You can try MetaInspector live at this little demo: <a href="https://metainspectordemo.herokuapp.com">https://metainspectordemo.herokuapp.com</a></p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Install the gem from RubyGems:</p>

<pre><code>gem install metainspector
</code></pre>

<p>If you're using it on a Rails application, just add it to your Gemfile and run <code>bundle install</code></p>

<pre><code>gem 'metainspector'
</code></pre>

<p>This gem is tested on Ruby versions 1.9.2, 1.9.3, 2.0.0 and 2.1.0.</p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Initialize a MetaInspector instance for an URL, like this:</p>

<pre><code>page = MetaInspector.new('http://sitevalidator.com')
</code></pre>

<p>If you don't include the scheme on the URL, http:// will be used by default:</p>

<pre><code>page = MetaInspector.new('sitevalidator.com')
</code></pre>

<p>You can also include the html which will be used as the document to scrape:</p>

<pre><code>page = MetaInspector.new("http://sitevalidator.com", :document =&gt; "&lt;html&gt;&lt;head&gt;&lt;title&gt;Hello From Passed Html&lt;/title&gt;&lt;a href='/hello'&gt;Hello link&lt;/a&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;")
</code></pre>

<h2>
<a name="accessing-scraped-data" class="anchor" href="#accessing-scraped-data"><span class="octicon octicon-link"></span></a>Accessing scraped data</h2>

<p>Then you can see the scraped data like this:</p>

<pre><code>page.url                 # URL of the page
page.scheme              # Scheme of the page (http, https)
page.host                # Hostname of the page (like, sitevalidator.com, without the scheme)
page.root_url            # Root url (scheme + host, like http://sitevalidator.com/)
page.title               # title of the page, as string
page.links               # array of strings, with every link found on the page as an absolute URL
page.internal_links      # array of strings, with every internal link found on the page as an absolute URL
page.external_links      # array of strings, with every external link found on the page as an absolute URL
page.meta['keywords']    # meta keywords, as string
page.meta['description'] # meta description, as string
page.description         # returns the meta description, or the first long paragraph if no meta description is found
page.image               # Most relevant image, if defined with the og:image meta tag
page.images              # array of strings, with every img found on the page as an absolute URL
page.feed                # Get rss or atom links in meta data fields as array
page.charset             # UTF-8
page.content_type        # content-type returned by the server when the url was requested
</code></pre>

<h2>
<a name="meta-tags" class="anchor" href="#meta-tags"><span class="octicon octicon-link"></span></a>Meta tags</h2>

<p>When it comes to meta tags, you have several options:</p>

<pre><code>page.meta_tags          # Gives you all the meta tags by type:
                        # (meta name, meta http-equiv, meta property and meta charset)
                        # As meta tags can be repeated (in the case of 'og:image', for example),
                        # the values returned will be arrays
                        #
                        # For example:
                        #
                        # {
                            'name' =&gt; {
                                        'keywords'       =&gt; ['one, two, three'],
                                        'description'    =&gt; ['the description'],
                                        'author'         =&gt; ['Joe Sample'],
                                        'robots'         =&gt; ['index,follow'],
                                        'revisit'        =&gt; ['15 days'],
                                        'dc.date.issued' =&gt; ['2011-09-15']
                                       },

                            'http-equiv' =&gt; {
                                              'content-type'        =&gt; ['text/html; charset=UTF-8'],
                                              'content-style-type'  =&gt; ['text/css']
                                            },

                            'property' =&gt; {
                                            'og:title'        =&gt; ['An OG title'],
                                            'og:type'         =&gt; ['website'],
                                            'og:url'          =&gt; ['http://example.com/meta-tags'],
                                            'og:image'        =&gt; ['http://example.com/rock.jpg',
                                                                  'http://example.com/rock2.jpg',
                                                                  'http://example.com/rock3.jpg'],
                                            'og:image:width'  =&gt; ['300'],
                                            'og:image:height' =&gt; ['300', '1000']
                                          },

                            'charset' =&gt; ['UTF-8']
                          }
</code></pre>

<p>As this method returns a hash, you can also take only the key that you need, like in:</p>

<pre><code>page.meta_tags['property']  # Returns:
                            # {
                            #   'og:title'        =&gt; ['An OG title'],
                            #   'og:type'         =&gt; ['website'],
                            #   'og:url'          =&gt; ['http://example.com/meta-tags'],
                            #   'og:image'        =&gt; ['http://example.com/rock.jpg',
                            #                         'http://example.com/rock2.jpg',
                            #                         'http://example.com/rock3.jpg'],
                            #   'og:image:width'  =&gt; ['300'],
                            #   'og:image:height' =&gt; ['300', '1000']
                            # }
</code></pre>

<p>In most cases you will only be interested in the first occurrence of a meta tag, so you can
use the singular form of that method:</p>

<pre><code>page.meta_tag['name']  # Returns:
                       # {
                       #   'keywords'       =&gt; 'one, two, three',
                       #   'description'    =&gt; 'the description',
                       #   'author'         =&gt; 'Joe Sample',
                       #   'robots'         =&gt; 'index,follow',
                       #   'revisit'        =&gt; '15 days',
                       #   'dc.date.issued' =&gt; '2011-09-15'
                       #  }
</code></pre>

<p>Or, as this is also a hash:</p>

<pre><code>page.meta_tag['name']['keywords']    # Returns 'one, two, three'
</code></pre>

<p>And finally, you can use the shorter <code>meta</code> method that will merge the different keys so you have
a simpler hash:</p>

<pre><code>page.meta       # Returns:
                #
                # {
                #     'keywords'            =&gt; 'one, two, three',
                #     'description'         =&gt; 'the description',
                #     'author'              =&gt; 'Joe Sample',
                #     'robots'              =&gt; 'index,follow',
                #     'revisit'             =&gt; '15 days',
                #     'dc.date.issued'      =&gt; '2011-09-15',
                #     'content-type'        =&gt; 'text/html; charset=UTF-8',
                #     'content-style-type'  =&gt; 'text/css',
                #     'og:title'            =&gt; 'An OG title',
                #     'og:type'             =&gt; 'website',
                #     'og:url'              =&gt; 'http://example.com/meta-tags',
                #     'og:image'            =&gt; 'http://example.com/rock.jpg',
                #     'og:image:width'      =&gt; '300',
                #     'og:image:height'     =&gt; '300',
                #     'charset'             =&gt; 'UTF-8'
                #   }
</code></pre>

<p>This way, you can get most meta tags just like that:</p>

<pre><code>page.meta['author']     # Returns "Joe Sample"
</code></pre>

<p>Please be aware that all keys are converted to downcase, so it's <code>'dc.date.issued'</code> and not <code>'DC.date.issued'</code>.</p>

<h2>
<a name="other-representations" class="anchor" href="#other-representations"><span class="octicon octicon-link"></span></a>Other representations</h2>

<p>You can also access most of the scraped data as a hash:</p>

<pre><code>page.to_hash  # { "url"   =&gt; "http://sitevalidator.com",
                  "title" =&gt; "MarkupValidator :: site-wide markup validation tool", ... }
</code></pre>

<p>The original document is accessible from:</p>

<pre><code>page.to_s         # A String with the contents of the HTML document
</code></pre>

<p>And the full scraped document is accessible from:</p>

<pre><code>page.parsed  # Nokogiri doc that you can use it to get any element from the page
</code></pre>

<h2>
<a name="options" class="anchor" href="#options"><span class="octicon octicon-link"></span></a>Options</h2>

<h3>
<a name="timeout" class="anchor" href="#timeout"><span class="octicon octicon-link"></span></a>Timeout</h3>

<p>By default, MetaInspector times out after 20 seconds of waiting for a page to respond.
You can set a different timeout with a second parameter, like this:</p>

<pre><code>page = MetaInspector.new('sitevalidator.com', :timeout =&gt; 5) # 5 seconds timeout
</code></pre>

<h3>
<a name="redirections" class="anchor" href="#redirections"><span class="octicon octicon-link"></span></a>Redirections</h3>

<p>By default, redirections from HTTP to HTTPS, and from HTTPS to HTTP are disallowed.</p>

<p>However, you can tell MetaInspector to allow these redirections with the option <code>:allow_redirections</code>, like this:</p>

<pre><code> # This will allow HTTP =&gt; HTTPS redirections
 page = MetaInspector.new('facebook.com', :allow_redirections =&gt; :safe)

 # And this will allow HTTP =&gt; HTTPS ("safe") and HTTPS =&gt; HTTP ("unsafe") redirections
 page = MetaInspector.new('facebook.com', :allow_redirections =&gt; :all)
</code></pre>

<h3>
<a name="headers" class="anchor" href="#headers"><span class="octicon octicon-link"></span></a>Headers</h3>

<p>By default, the following headers are set:</p>

<pre><code>{'User-Agent' =&gt; "MetaInspector/#{MetaInspector::VERSION} (+https://github.com/jaimeiniesta/metainspector)"}
</code></pre>

<p>If you want to set custom headers then use the <code>headers</code> option:</p>

<pre><code> # Set the User-Agent header
 page = MetaInspector.new('example.com', :headers =&gt; {'User-Agent' =&gt; 'My custom User-Agent'})
</code></pre>

<h3>
<a name="html-content-only" class="anchor" href="#html-content-only"><span class="octicon octicon-link"></span></a>HTML Content Only</h3>

<p>MetaInspector will try to parse all URLs by default. If you want to raise an exception when trying to parse a non-html URL (one that has a content-type different than text/html), you can state it like this:</p>

<pre><code>page = MetaInspector.new('sitevalidator.com', :html_content_only =&gt; true)
</code></pre>

<p>This is useful when using MetaInspector on web spidering. Although on the initial URL you'll probably have an HTML URL, following links you may find yourself trying to parse non-html URLs.</p>

<pre><code>page = MetaInspector.new('http://example.com/image.png')
page.content_type  # "image/png"
page.description   # will returned a garbled string

page = MetaInspector.new('http://example.com/image.png', :html_content_only =&gt; true)
page.content_type  # "image/png"
page.description   # raises an exception
</code></pre>

<h2>
<a name="exception-handling" class="anchor" href="#exception-handling"><span class="octicon octicon-link"></span></a>Exception handling</h2>

<p>By default, MetaInspector will raise the exceptions found. We think that this is the safest default: in case the URL you're trying to scrape is unreachable, you should clearly be notified, and treat the exception as needed in your app.</p>

<p>However, if you prefer you can also set the <code>warn_level: :warn</code> option, so that exceptions found will just be warned on the standard output, instead of being raised.</p>

<p>You can also set the <code>warn_level: :store</code> option so that exceptions found will be silenced, and left for you to inspect on <code>page.exceptions</code>. You can also ask for <code>page.ok?</code>, wich will return <code>true</code> if no exceptions are stored.</p>

<p>You should avoid using the <code>:store</code> option, or use it wisely, as silencing errors can be problematic, it's always better to face the errors and treat them accordingly.</p>

<h2>
<a name="examples" class="anchor" href="#examples"><span class="octicon octicon-link"></span></a>Examples</h2>

<p>You can find some sample scripts on the samples folder, including a basic scraping and a spider that will follow external links using a queue. What follows is an example of use from irb:</p>

<pre><code>$ irb
&gt;&gt; require 'metainspector'
=&gt; true

&gt;&gt; page = MetaInspector.new('http://sitevalidator.com')
=&gt; #&lt;MetaInspector:0x11330c0 @url="http://sitevalidator.com"&gt;

&gt;&gt; page.title
=&gt; "MarkupValidator :: site-wide markup validation tool"

&gt;&gt; page.meta['description']
=&gt; "Site-wide markup validation tool. Validate the markup of your whole site with just one click."

&gt;&gt; page.meta['keywords']
=&gt; "html, markup, validation, validator, tool, w3c, development, standards, free"

&gt;&gt; page.links.size
=&gt; 15

&gt;&gt; page.links[4]
=&gt; "/plans-and-pricing"
</code></pre>

<h2>
<a name="zomg-fork-thank-you" class="anchor" href="#zomg-fork-thank-you"><span class="octicon octicon-link"></span></a>ZOMG Fork! Thank you!</h2>

<p>You're welcome to fork this project and send pull requests. Just remember to include specs.</p>

<p>Thanks to all the contributors:</p>

<p><a href="https://github.com/jaimeiniesta/metainspector/graphs/contributors">https://github.com/jaimeiniesta/metainspector/graphs/contributors</a></p>

<h2>
<a name="related-projects" class="anchor" href="#related-projects"><span class="octicon octicon-link"></span></a>Related projects</h2>

<ul>
<li>
<a href="https://github.com/fern4lvarez/go-metainspector">go-metainspector</a>, a port of MetaInspector for Go.</li>
<li>
<a href="https://github.com/gabceb/node-metainspector">Node-MetaInspector</a>, a port of MetaInspector for Node.</li>
</ul><h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>MetaInspector is released under the <a href="MIT-LICENSE">MIT license</a>.</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/jaimeiniesta/metainspector/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/jaimeiniesta/metainspector/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/jaimeiniesta/metainspector"></a> is maintained by <a href="https://github.com/jaimeiniesta">jaimeiniesta</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>